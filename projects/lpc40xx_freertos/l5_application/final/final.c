/***********************************************************************************************************************
 *
 *                                                  I N C L U D E S
 *
 **********************************************************************************************************************/
/* Main Module Header */

#include "final.h"

/* Standard Includes */

/* External Includes */

/* Private Module Includes */

/***********************************************************************************************************************
 *
 *                                                   D E F I N E S
 *
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *
 *                                                  T Y P E D E F S
 *
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *
 *                             P R I V A T E   F U N C T I O N   D E C L A R A T I O N S
 *
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *
 *                                  P R I V A T E   D A T A   D E F I N I T I O N S
 *
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *
 *                                         P R I V A T E   F U N C T I O N S
 *
 **********************************************************************************************************************/

/***********************************************************************************************************************
 *
 *                                          P U B L I C   F U N C T I O N S
 *
 **********************************************************************************************************************/
void traffic_light__init(traffic_light_s *traffic_light, traffic_time_s traffic_time) {
  traffic_light->current_state = red;
  traffic_light->timings.red_time_in_seconds = 10;
  traffic_light->timings.green_time_in_seconds = 10;
  traffic_light->timings.yellow_time_in_seconds = 3;
}

traffic_light_e traffic_light__run(traffic_light_s *traffic_light, uint32_t hz_1_counter) {
  traffic_light->time_counter = hz_1_counter;
  switch (traffic_light->current_state) {
  case red: {
    if (traffic_light->time_counter > 10) {
      traffic_light->current_state = yellow;
    }
    break;
  }
  case yellow: {
    if (hz_1_counter - traffic_light->time_counter > 3) {
      traffic_light->current_state = green;
    }
    break;
  }
  case green: {
    if (hz_1_counter - traffic_light->time_counter > 10) {
      traffic_light->current_state = red;
    }
    break;
  }
  }
  return traffic_light->current_state;
}
